// Explicitly setting up instrumentation for inline mocking (Java 21+) ì„¤ì •
// VSCode Java Testì™€ Gradle Test ëª¨ë‘ì—ì„œ JavaAgentê°€ ì œëŒ€ë¡œ ì¸ì‹ë˜ë„ë¡ í•˜ëŠ” ì„¤ì •
// * https://javadoc.io/doc/org.mockito/mockito-core/latest/org.mockito/org/mockito/Mockito.html#0.3

configurations {
  mockitoAgent
}

dependencies {
  // mockitoAgent('org.mockito:mockito-core') {
  // ğŸ’¡ tomlì— ì •ì˜ í–ˆì„ ê²½ìš° ì•„ë˜ë¡œ ì‚¬ìš©
  mockitoAgent(libs.mockito.core) {
    transitive = false
  }
}

// vscode-java-testê°€ build.gradleì˜ test ì„¤ì •ì„ ì¸ì‹í•˜ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì—,
// -javaagent ì„¤ì •ì´ í•„ìš”í•  ê²½ìš° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•˜ëŠ” í…ŒìŠ¤í¬ë¥¼ ë§Œë“¤ì—ˆë‹¤.
tasks.register('copyMockitoJar') {
  def javaAgentLibsDir = "${project.rootDir}/javaagent-libs"
  doLast {
    delete fileTree(dir: javaAgentLibsDir, include: '**/*.jar')
    copy {
      from configurations.mockitoAgent
      into javaAgentLibsDir
    }
  }
}

// ì˜ì¡´ì„± í•´ê²° í›„ Jar íŒŒì¼ì„ ë³µì‚¬
afterEvaluate {
  tasks.named('copyMockitoJar').configure {
    dependsOn classes
  }
}

tasks.named('test') {
  jvmArgs += ["-javaagent:${configurations.mockitoAgent.asPath}", "-Xshare:off"]
}
